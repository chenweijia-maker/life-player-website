# 公网访问配置说明

## 方式一：通过 URL 参数配置（推荐）

在浏览器地址栏访问前端时，添加 `?api=` 参数：

```
http://your-frontend-server.com/?api=http://your-backend-server.com:4000
```

例如：
```
http://localhost:3000/?api=http://192.168.1.100:4000
http://your-domain.com/?api=https://api.your-domain.com
```

**优点**：无需修改代码，灵活配置

## 方式二：通过浏览器控制台配置

1. 打开浏览器开发者工具（F12）
2. 在 Console（控制台）中输入：

```javascript
localStorage.setItem('api_base_url', 'http://your-backend-server.com:4000');
```

3. 刷新页面即可生效

**优点**：一次配置，持久保存（除非清除浏览器数据）

## 方式三：修改代码中的默认值

编辑 `frontend/index.html`，找到第 755 行左右：

```javascript
return 'http://localhost:4000';
```

改为你的服务器地址：

```javascript
return 'http://your-backend-server.com:4000';
```

## 后端服务器配置

### 1. 确保后端监听所有网络接口

后端代码已配置为监听 `0.0.0.0`，这意味着：
- ✅ 本地可以访问：`http://localhost:4000`
- ✅ 局域网可以访问：`http://<你的内网IP>:4000`
- ✅ 公网可以访问：`http://<你的公网IP>:4000`（如果有公网IP）

### 2. 启动后端服务器

```bash
cd backend
node server.js
```

### 3. 检查防火墙

确保防火墙允许 4000 端口的入站连接：
- Windows：在"Windows Defender 防火墙"中添加端口规则
- Linux：`sudo ufw allow 4000` 或配置 iptables
- Mac：在"系统偏好设置 > 安全性与隐私 > 防火墙"中配置

## 部署到公网的几种方案

### 方案一：使用云服务器（推荐）

1. **购买云服务器**（阿里云、腾讯云、AWS 等）
2. **配置安全组**：开放 4000 端口（后端）和 3000 端口（前端）
3. **部署代码**：
   ```bash
   # 后端
   cd backend
   node server.js
   
   # 前端（使用 nginx 或 serve）
   cd frontend
   npx serve -p 3000
   ```
4. **配置域名**（可选）：
   - 前端：`http://your-domain.com`
   - 后端：`http://api.your-domain.com:4000`

### 方案二：使用内网穿透服务

如果服务器在局域网内，可以使用内网穿透：

1. **ngrok**（免费版有限制）：
   ```bash
   ngrok http 4000
   ```
   会得到一个公网地址，如：`https://xxxx.ngrok.io`

2. **frp**（自建服务器）：
   需要一台有公网 IP 的服务器作为中转

3. **其他服务**：花生壳、natapp 等

### 方案三：使用 Docker + 云平台

1. 创建 Dockerfile
2. 部署到 Docker Hub
3. 使用云平台的容器服务（如 Vercel、Railway、Render 等）

## 安全建议

1. **使用 HTTPS**：生产环境建议使用 HTTPS
2. **添加认证**：考虑添加 API 密钥或更严格的认证
3. **限制 CORS**：在生产环境中限制允许的来源
4. **使用环境变量**：敏感信息不要硬编码在代码中

## 测试连接

配置完成后，可以在浏览器控制台测试：

```javascript
// 测试 API 连接
fetch('http://your-backend-server.com:4000/api/auth/send-code', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ phone: '13800138000' })
})
.then(r => r.json())
.then(console.log)
.catch(console.error);
```

如果返回 `{ success: true }` 或类似响应，说明连接成功！
