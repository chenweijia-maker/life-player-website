# ✅ Android APP 构建进度

## 🎉 已完成的工作

1. ✅ **安装项目依赖** - `npm install` 完成
2. ✅ **添加 Android 平台** - Android 项目已创建
3. ✅ **构建前端资源** - `dist` 目录已创建，文件已复制
4. ✅ **同步 Capacitor** - 资源已同步到 Android 项目

## 🚀 接下来你需要做的（按顺序）

### 1️⃣ 启动后端服务器（必须）

打开一个新的终端窗口，在项目目录执行：

```bash
npm start
```

**重要：** 保持这个终端窗口运行，后端会在 `http://localhost:4000` 运行。

你会看到类似输出：
```
后端服务器运行在 http://localhost:4000
```

### 2️⃣ 查找你的电脑 IP 地址

**Windows：**
打开命令提示符（cmd），执行：
```bash
ipconfig
```

查找 "IPv4 地址"，例如：
- `192.168.1.100`
- `192.168.0.105`
- `10.0.0.50`

**记录下这个 IP 地址，下一步要用！**

### 3️⃣ 配置后端服务器地址

编辑 `capacitor.config.js` 文件，找到这一行：

```javascript
url: 'http://localhost:4000',
```

改为你的电脑 IP（使用步骤 2 中找到的 IP）：

```javascript
url: 'http://192.168.1.100:4000',  // 替换为你的实际 IP
```

**保存文件。**

### 4️⃣ 在 Android Studio 中打开项目

执行以下命令：

```bash
npm run cap:open:android
```

如果命令失败或 Android Studio 没有自动打开，手动操作：
1. 打开 Android Studio
2. 选择 "Open an Existing Project"
3. 选择项目目录下的 `android` 文件夹

### 5️⃣ 等待 Gradle 同步

首次打开 Android 项目时，Android Studio 会自动同步 Gradle：
- 底部状态栏会显示 "Gradle sync in progress..."
- 这可能需要几分钟（取决于网络速度）
- 等待同步完成

### 6️⃣ 创建/选择 Android 设备

**方式 A：使用模拟器（推荐首次测试）**

1. 点击 Android Studio 右侧的 "Device Manager" 图标
2. 点击 "Create Device" 按钮
3. 选择一个设备型号（如 Pixel 5）
4. 选择一个系统镜像（推荐 API 33 或更高）
5. 点击 "Finish" 完成创建
6. 点击设备旁边的播放按钮启动模拟器

**方式 B：使用真机**

1. 在手机上启用"开发者选项"：
   - 设置 > 关于手机 > 连续点击"版本号"7次
2. 启用 USB 调试：
   - 设置 > 开发者选项 > 启用"USB 调试"
3. 用 USB 连接手机到电脑
4. 在手机上允许 USB 调试授权
5. 在 Android Studio 的设备列表中选择你的手机

### 7️⃣ 运行应用

1. 在 Android Studio 顶部工具栏，选择你的设备（模拟器或真机）
2. 点击绿色的运行按钮（▶️）或按 `Shift + F10`
3. 等待应用构建和安装（首次可能需要几分钟）
4. 应用会自动启动

### 8️⃣ 测试登录

1. 应用启动后，应该能看到登录界面
2. 输入手机号（任意，如：`13800138000`）
3. 点击"发送验证码"
4. 输入验证码：`123456`（开发环境固定）
5. 点击"登录"
6. 登录成功后即可使用所有功能！

## 📱 构建 APK 安装包（可选）

如果想生成 APK 文件直接安装到其他手机：

1. 在 Android Studio 中选择 "Build" > "Build Bundle(s) / APK(s)" > "Build APK(s)"
2. 等待构建完成（底部会显示进度）
3. 构建完成后，点击通知中的 "locate" 链接
4. 或者手动找到文件：`android/app/build/outputs/apk/debug/app-debug.apk`
5. 将这个 APK 文件传输到手机并安装

## ⚠️ 重要提示

1. **后端服务器必须运行**：应用需要连接后端服务器才能工作
2. **不能使用 localhost**：Android 设备上的 localhost 指向设备本身，必须使用电脑的 IP
3. **确保同一网络**：手机和电脑必须在同一个 Wi-Fi 网络
4. **每次修改代码后**：需要重新同步
   ```bash
   # 复制文件到 dist
   Copy-Item -Path "frontend\*" -Destination "dist\" -Recurse -Force
   # 同步到 Android
   npm run cap:sync
   ```

## 🆘 遇到问题？

### 问题：找不到 ANDROID_HOME
**解决：**
- 确保已安装 Android Studio
- 在 Android Studio 中安装 Android SDK（Tools > SDK Manager）
- 添加环境变量（见 `ANDROID_BUILD.md`）

### 问题：API 请求失败
**解决：**
- 检查后端是否运行：`npm start`
- 检查 `capacitor.config.js` 中的 IP 是否正确
- 确保手机和电脑在同一网络

### 问题：Gradle 构建失败
**解决：**
- 确保网络连接正常
- 在 Android Studio 中选择 "File" > "Invalidate Caches / Restart"
- 等待 Gradle 同步完成

## 📚 参考文档

- `ANDROID_BUILD.md` - 完整构建指南
- `README_ANDROID.md` - Android 快速开始
- `如何查看产品_Android版.md` - 详细使用说明
- `执行步骤清单.md` - 详细步骤清单

## 🎉 完成！

完成以上步骤后，你就可以在 Android 设备上使用「人生玩家」APP 了！

祝你使用愉快！🚀
