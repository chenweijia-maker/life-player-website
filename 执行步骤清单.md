# Android APP 构建 - 执行步骤清单

## ✅ 已完成

- [x] 安装项目依赖 (`npm install`)
- [x] 添加 Android 平台支持
- [x] 创建 dist 目录并复制前端文件
- [x] 配置 Capacitor

## 🔄 接下来需要你手动执行

由于系统权限限制，以下步骤需要你在终端中手动执行：

### 步骤 1: 确认 dist 目录已创建

检查 `dist` 文件夹是否存在，并且包含 `index.html` 文件。

如果不存在，执行：
```powershell
# PowerShell
New-Item -ItemType Directory -Force -Path dist
Copy-Item -Path "frontend\*" -Destination "dist\" -Recurse -Force
```

### 步骤 2: 同步 Capacitor 资源

```bash
npm run cap:sync
```

这会同步前端资源到 Android 项目。

### 步骤 3: 启动后端服务器

**重要：必须先启动后端！**

打开一个新的终端窗口，执行：
```bash
npm start
```

保持这个终端窗口运行，后端会在 `http://localhost:4000` 运行。

### 步骤 4: 查找你的电脑 IP 地址

**Windows：**
打开命令提示符（cmd），执行：
```bash
ipconfig
```

查找 "IPv4 地址"，例如：`192.168.1.100` 或 `192.168.0.105`

### 步骤 5: 配置后端服务器地址

编辑 `capacitor.config.js` 文件，找到这一行：
```javascript
url: 'http://localhost:4000',
```

改为你的电脑 IP，例如：
```javascript
url: 'http://192.168.1.100:4000',
```

保存文件。

### 步骤 6: 在 Android Studio 中打开项目

```bash
npm run cap:open:android
```

如果 Android Studio 没有自动打开，手动打开：
- 打开 Android Studio
- 选择 "Open an Existing Project"
- 选择项目目录下的 `android` 文件夹

### 步骤 7: 配置 Android Studio

1. **等待 Gradle 同步完成**（首次打开可能需要几分钟）

2. **创建/选择 Android 虚拟设备（模拟器）**：
   - 点击 "Device Manager" 图标
   - 点击 "Create Device"
   - 选择一个设备（如 Pixel 5）
   - 选择一个系统镜像（如 API 33）
   - 完成创建

3. **或者连接真机**：
   - 在手机上启用"开发者选项"和"USB 调试"
   - 用 USB 连接手机
   - 在 Android Studio 中选择你的设备

### 步骤 8: 运行应用

1. 在 Android Studio 顶部选择设备（模拟器或真机）
2. 点击绿色的运行按钮（▶️）或按 `Shift + F10`
3. 等待应用构建和安装
4. 应用会自动启动

### 步骤 9: 测试应用

1. 应用启动后，应该能看到登录界面
2. 输入手机号（任意，如：13800138000）
3. 验证码输入：`123456`（开发环境固定）
4. 登录后即可使用所有功能

## 📱 构建 APK 安装包（可选）

如果想生成 APK 文件直接安装到手机：

1. 在 Android Studio 中选择 "Build" > "Build Bundle(s) / APK(s)" > "Build APK(s)"
2. 等待构建完成
3. 点击 "locate" 链接，或手动找到文件：
   `android/app/build/outputs/apk/debug/app-debug.apk`
4. 将 APK 文件传输到手机并安装

## ⚠️ 常见问题

### Q: 找不到 ANDROID_HOME？
**A:** 
- 确保已安装 Android Studio
- 在 Android Studio 中安装 Android SDK
- 添加环境变量（见 ANDROID_BUILD.md）

### Q: API 请求失败？
**A:**
- 确保后端服务器正在运行：`npm start`
- 检查 `capacitor.config.js` 中的 IP 地址是否正确
- 确保手机和电脑在同一网络

### Q: Gradle 构建失败？
**A:**
- 确保网络连接正常（Gradle 需要下载依赖）
- 在 Android Studio 中选择 "File" > "Invalidate Caches / Restart"
- 等待 Gradle 同步完成

### Q: 应用无法连接后端？
**A:**
- 检查后端是否运行：`npm start`
- 检查 IP 地址是否正确（不能使用 localhost）
- 确保手机和电脑在同一 Wi-Fi 网络

## 📞 需要帮助？

如果遇到问题：
1. 查看 Android Studio 的 "Build" 标签页错误信息
2. 查看后端终端输出的日志
3. 参考 `ANDROID_BUILD.md` 获取详细说明

## 🎉 完成！

完成以上步骤后，你就可以在 Android 设备上使用「人生玩家」APP 了！
